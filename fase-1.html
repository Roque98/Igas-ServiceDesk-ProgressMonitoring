<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fase 1: Autenticaci√≥n y Gesti√≥n de Usuarios - iGAS Service Desk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background: white;
            padding-top: 60px;
        }

        /* Navegaci√≥n sticky */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #3E3E3E;
            padding: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .navbar ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
        }

        .navbar li {
            margin: 0;
        }

        .navbar a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-size: 14px;
        }

        .navbar a:hover {
            background: rgba(249, 176, 0, 0.1);
            color: #F9B000;
        }

        .navbar a.active {
            color: #F9B000;
            border-bottom-color: #F9B000;
            background: rgba(249, 176, 0, 0.05);
        }

        .header {
            background: linear-gradient(135deg, #F9B000 0%, #FDB913 100%);
            color: white;
            padding: 40px 30px;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin: 10px 10px 0 0;
        }

        .badge-proceso { background: #FFC107; color: #333; }
        .badge-pendiente { background: rgba(255,255,255,0.3); }
        .badge-completado { background: #4CAF50; }
        .badge-critica { background: #F44336; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .progress-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-bar-container {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            position: relative;
            margin: 15px 0;
        }

        .progress-bar-fill {
            background: linear-gradient(90deg, #4CAF50 0%, #00A651 100%);
            height: 100%;
            border-radius: 15px;
            transition: width 0.3s ease;
        }

        .progress-bar-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            font-size: 14px;
        }

        .content-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .content-section h2 {
            color: #F9B000;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #F9B000;
        }

        .content-section h3 {
            color: #3E3E3E;
            font-size: 20px;
            margin: 25px 0 15px 0;
        }

        .content-section h4 {
            color: #666;
            font-size: 16px;
            margin: 20px 0 10px 0;
        }

        .content-section ul, .content-section ol {
            margin: 15px 0 15px 30px;
        }

        .content-section li {
            margin: 8px 0;
        }

        .content-section code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .code-block {
            background: #f8f9fa;
            color: #333;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            border: 1px solid #e0e0e0;
            white-space: pre-wrap;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #FFC107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #f8d7da;
            border-left: 4px solid #F44336;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th {
            background: #F9B000;
            color: white;
            padding: 12px;
            text-align: left;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .footer {
            background: #3E3E3E;
            color: white;
            padding: 30px;
            text-align: center;
            margin-top: 50px;
        }

        .footer p {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .navbar ul {
                flex-wrap: wrap;
            }

            .navbar a {
                padding: 12px 15px;
                font-size: 13px;
            }

            .header h1 {
                font-size: 24px;
            }

            .container {
                padding: 20px 15px;
            }
        }

        @media print {
            body {
                padding-top: 0;
            }
            .navbar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="overview.html">Overview</a></li>
            <li><a href="fase-0.html">Fase 0</a></li>
            <li><a href="fase-1.html" class="active">Fase 1</a></li>
            <li><a href="fase-2.html">Fase 2</a></li>
            <li><a href="fase-3.html">Fase 3</a></li>
            <li><a href="fase-4.html">Fase 4</a></li>
            <li><a href="fase-5.html">Fase 5</a></li>
            <li><a href="fase-6.html">Fase 6</a></li>
            <li><a href="fase-7.html">Fase 7</a></li>
        </ul>
    </nav>

    <div class="header">
        <div class="container">
            <h1>Fase 1: Autenticaci√≥n y Gesti√≥n de Usuarios</h1>
            <span class="badge badge-en proceso">En Proceso</span>
            <span class="badge badge-proceso">40%</span>
        </div>
    </div>

    <div class="container">
        <div class="progress-card">
            <h3>Progreso de la Fase</h3>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: 40%;"></div>
                <div class="progress-bar-text">40% Completado</div>
            </div>
        </div>

        <div class="content-section"><h2>Objetivo</h2>
Completar el sistema de autenticaci√≥n, implementar gesti√≥n de usuarios, roles y permisos seg√∫n las especificaciones del m√≥dulo "Usuarios / Agentes de Soporte".

---

<div class="content-section"><h2>Tareas</h2>

<h3>1. Sistema de Autenticaci√≥n (Mejoras)</h3>

<h4>1.1 Backend - Supabase Auth (Mejoras)</h4>
<li>‚úÖ Login con email/password (ya implementado)</li>
<li>‚úÖ Recuperaci√≥n de contrase√±a (ya implementado)</li>
<li>‚úÖ Cambio de contrase√±a (ya implementado)</li>
<li>‚úÖ Mejorar manejo de errores con mensajes en espa√±ol <a href="#version-1-1-0" style="font-size: 11px; color: #4CAF50;">[v1.1.0]</a></li>
<li>‚úÖ Implementar refresh token autom√°tico <a href="#version-1-8-0" style="font-size: 11px; color: #4CAF50;">[v1.8.0]</a></li>
<li>‚ö™ Configurar pol√≠ticas de contrase√±a en Supabase</li>
<li>‚ö™ Implementar bloqueo de cuenta despu√©s de X intentos fallidos</li>

**NOTA:** No habr√° registro p√∫blico. Los usuarios ser√°n creados √∫nicamente por administradores desde el panel de gesti√≥n de usuarios.

<h4>1.2 Frontend - Auth (Mejoras)</h4>
<li>‚úÖ P√°ginas de login, forgot-password, reset-password</li>
<li>‚úÖ Personalizar p√°ginas con branding iGAS (amarillo #F9B000) <a href="#version-1-2-0" style="font-size: 11px; color: #4CAF50;">[v1.2.0]</a></li>
<li>‚úÖ Agregar loading states con spinner <a href="#version-1-3-0" style="font-size: 11px; color: #4CAF50;">[v1.3.0]</a></li>
<li>‚ö™ Implementar validaciones de formulario mejoradas</li>
<li>‚úÖ Agregar "Remember me" en login <a href="#version-1-4-0" style="font-size: 11px; color: #4CAF50;">[v1.4.0]</a></li>
<li>‚úÖ Implementar auto-logout por inactividad (30 min) - Excluido dashboard <a href="#version-1-5-0" style="font-size: 11px; color: #4CAF50;">[v1.5.0]</a></li>
<li>‚úÖ Agregar confirmaci√≥n visual de acciones <a href="#version-1-6-0" style="font-size: 11px; color: #4CAF50;">[v1.6.0]</a></li>
<li>‚úÖ Eliminar links y referencias a "registro" en p√°gina de login <a href="#version-1-7-0" style="font-size: 11px; color: #4CAF50;">[v1.7.0]</a></li>

<h4>1.3 Seguridad</h4>
<li>‚ö™ Implementar rate limiting en Supabase (configuraci√≥n)</li>
<li>‚ö™ Implementar detecci√≥n de sesi√≥n en m√∫ltiples dispositivos</li>
<li>‚ö™ Agregar logs de intentos de login fallidos</li>

<h3>2. Gesti√≥n de Usuarios / Agentes</h3>

<h4>2.1 Modelo de Datos - Tabla profiles en Supabase</h4>
</p><div class="code-block">CREATE TABLE public.profiles (
  id UUID REFERENCES auth.users(id) PRIMARY KEY,
  nombre_completo TEXT NOT NULL,
  email TEXT NOT NULL,
  rol_id UUID REFERENCES roles(id),
  area_equipo_id UUID REFERENCES equipos(id),
  telefono TEXT,
  estatus TEXT CHECK (estatus IN ('Activo', 'Inactivo')) DEFAULT 'Activo',
  turno_horario_id UUID REFERENCES horarios(id),
  avatar_url TEXT,
  disponibilidad TEXT CHECK (disponibilidad IN ('En l√≠nea', 'Ocupado', 'Fuera de turno')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Trigger para crear profile autom√°ticamente cuando un admin crea un usuario
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $
BEGIN
  INSERT INTO public.profiles (id, nombre_completo, email)
  VALUES (NEW.id, NEW.raw_user_meta_data->>'nombre_completo', NEW.email);
  RETURN NEW;
END;
$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();</div>


<h4>2.2 Row Level Security (RLS) Policies</h4>
</p><div class="code-block">-- Habilitar RLS
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- Los usuarios pueden ver su propio perfil
CREATE POLICY "Users can view own profile"
  ON public.profiles FOR SELECT
  USING (auth.uid() = id);

-- Los usuarios pueden actualizar su propio perfil
CREATE POLICY "Users can update own profile"
  ON public.profiles FOR UPDATE
  USING (auth.uid() = id);

-- Solo admins pueden ver todos los perfiles
CREATE POLICY "Admins can view all profiles"
  ON public.profiles FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM profiles p
      JOIN roles r ON p.rol_id = r.id
      WHERE p.id = auth.uid() AND r.nombre = 'Admin'
    )
  );

-- Solo admins pueden crear/actualizar/eliminar usuarios
CREATE POLICY "Admins can manage all profiles"
  ON public.profiles FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM profiles p
      JOIN roles r ON p.rol_id = r.id
      WHERE p.id = auth.uid() AND r.nombre = 'Admin'
    )
  );</div>


<h4>2.3 Servicio Angular - UserService</h4>
</p><div class="code-block">export interface Profile {
  id: string;
  nombre_completo: string;
  email: string;
  rol_id?: string;
  area_equipo_id?: string;
  telefono?: string;
  estatus: 'Activo' | 'Inactivo';
  turno_horario_id?: string;
  avatar_url?: string;
  disponibilidad?: 'En l√≠nea' | 'Ocupado' | 'Fuera de turno';
  created_at: string;
  updated_at: string;
}</div>


<li>‚ö™ Crear UserService con m√©todos CRUD</li>
<li>‚ö™ Implementar getUsers() con filtros</li>
<li>‚ö™ Implementar getUserById(id)</li>
<li>‚ö™ Implementar createUser(user)</li>
<li>‚ö™ Implementar updateUser(id, user)</li>
<li>‚ö™ Implementar deleteUser(id) - soft delete</li>
<li>‚ö™ Implementar getCurrentUserProfile()</li>
<li>‚ö™ Implementar updateCurrentUserProfile(data)</li>
<li>‚ö™ Implementar uploadAvatar(file)</li>

<h4>2.4 Frontend - M√≥dulo de Usuarios</h4>

<li>‚ö™ Crear m√≥dulo features/usuarios</li>
<li>‚ö™ Crear componente de listado de usuarios:</li>
  - ‚ö™ Tabla con datos de usuarios
  - ‚ö™ Filtros por estatus, rol, √°rea
  - ‚ö™ B√∫squeda por nombre/email
  - ‚ö™ Badges de estatus (Activo/Inactivo) con colores
  - ‚ö™ Paginaci√≥n
  - ‚ö™ Ordenamiento por columnas
<li>‚ö™ Crear componente de formulario de usuario:</li>
  - ‚ö™ Campos: nombre, email, rol, √°rea, tel√©fono, turno
  - ‚ö™ Selector de estatus
  - ‚ö™ Upload de avatar
  - ‚ö™ Validaciones
<li>‚ö™ Crear modal de creaci√≥n/edici√≥n</li>
<li>‚ö™ Crear confirmaci√≥n de eliminaci√≥n</li>
<li>‚ö™ Crear p√°gina de perfil de usuario:</li>
  - ‚ö™ Vista de informaci√≥n completa
  - ‚ö™ Edici√≥n de perfil propio
  - ‚ö™ Cambio de avatar
  - ‚ö™ Cambio de contrase√±a

<h3>3. Sistema de Roles y Permisos</h3>

<h4>3.1 Modelo de Datos - Roles</h4>
</p><div class="code-block">CREATE TABLE public.roles (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  nombre TEXT UNIQUE NOT NULL,
  descripcion TEXT,
  nivel_acceso INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE public.permisos (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  nombre TEXT UNIQUE NOT NULL,
  descripcion TEXT,
  modulo TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE public.roles_permisos (
  rol_id UUID REFERENCES roles(id) ON DELETE CASCADE,
  permiso_id UUID REFERENCES permisos(id) ON DELETE CASCADE,
  PRIMARY KEY (rol_id, permiso_id)
);

-- Insertar roles iniciales
INSERT INTO public.roles (nombre, descripcion, nivel_acceso) VALUES
  ('Admin', 'Administrador del sistema', 100),
  ('Coordinador', 'Coordinador de soporte', 80),
  ('T√©cnico', 'T√©cnico de soporte', 50),
  ('Dev', 'Desarrollador', 70),
  ('Implementaci√≥n', 'Equipo de implementaci√≥n', 60),
  ('Facturaci√≥n', 'Equipo de facturaci√≥n', 40);</div>


<h4>3.2 Definici√≥n de Permisos</h4>

<li>‚ö™ Definir permisos del sistema:</li>
  - ‚ö™ tickets.create, tickets.read, tickets.update, tickets.delete
  - ‚ö™ casos.create, casos.read, casos.update, casos.delete
  - ‚ö™ clientes.create, clientes.read, clientes.update, clientes.delete
  - ‚ö™ usuarios.create, usuarios.read, usuarios.update, usuarios.delete
  - ‚ö™ mantenimientos.create, mantenimientos.read, mantenimientos.update
  - ‚ö™ instalaciones.create, instalaciones.read, instalaciones.update
  - ‚ö™ reportes.read, reportes.export
  - ‚ö™ config.read, config.update
<li>‚ö™ Asignar permisos a roles</li>

<h4>3.3 Servicio Angular - RoleService & PermissionService</h4>

<li>‚ö™ Crear RoleService</li>
<li>‚ö™ Implementar getRoles()</li>
<li>‚ö™ Implementar getUserPermissions(userId)</li>
<li>‚ö™ Implementar hasPermission(permission): Observable<boolean></li>
<li>‚ö™ Implementar hasRole(role): Observable<boolean></li>

<h4>3.4 Guards y Directivas de Permisos</h4>
</p><div class="code-block">// Permission Guard
export const permissionGuard: CanActivateFn = (route) => {
  const requiredPermission = route.data['permission'];
  // Verificar si usuario tiene el permiso
};

// Role Guard
export const roleGuard: CanActivateFn = (route) => {
  const requiredRole = route.data['role'];
  // Verificar si usuario tiene el rol
};</div>


<li>‚ö™ Crear PermissionGuard</li>
<li>‚ö™ Crear RoleGuard</li>
<li>‚ö™ Crear directiva *hasPermission</li>
<li>‚ö™ Crear directiva *hasRole</li>
<li>‚ö™ Implementar en rutas protegidas</li>

<h3>4. Gesti√≥n de Equipos/√Åreas</h3>

<h4>4.1 Modelo de Datos - Equipos</h4>
</p><div class="code-block">CREATE TABLE public.equipos (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  nombre TEXT NOT NULL,
  descripcion TEXT,
  responsable_id UUID REFERENCES profiles(id),
  estatus TEXT CHECK (estatus IN ('Activo', 'Inactivo')) DEFAULT 'Activo',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Insertar equipos iniciales
INSERT INTO public.equipos (nombre, descripcion) VALUES
  ('Soporte', 'Equipo de soporte t√©cnico'),
  ('Dev', 'Equipo de desarrollo'),
  ('Implementaci√≥n', 'Equipo de implementaci√≥n'),
  ('Facturaci√≥n', 'Equipo de facturaci√≥n'),
  ('Cobranza', 'Equipo de cobranza');</div>


<h4>4.2 Backend - Queries Supabase</h4>

<li>‚ö™ Crear queries para CRUD de equipos</li>
<li>‚ö™ Implementar relaci√≥n equipos ‚Üî usuarios</li>
<li>‚ö™ Crear query para obtener miembros de un equipo</li>

<h4>4.3 Frontend - Gesti√≥n de Equipos</h4>

<li>‚ö™ Crear componente de gesti√≥n de equipos</li>
<li>‚ö™ Listar equipos con miembros</li>
<li>‚ö™ Asignar/remover usuarios de equipos</li>
<li>‚ö™ Mostrar responsable de equipo</li>

<h3>5. Horarios y Turnos</h3>

<h4>5.1 Modelo de Datos - Horarios</h4>
</p><div class="code-block">CREATE TABLE public.horarios (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  nombre TEXT NOT NULL,
  hora_inicio TIME NOT NULL,
  hora_fin TIME NOT NULL,
  dias_semana INTEGER[], -- Array: 0=Domingo, 1=Lunes, etc.
  es_horario_habil BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Insertar horarios iniciales
INSERT INTO public.horarios (nombre, hora_inicio, hora_fin, dias_semana, es_horario_habil) VALUES
  ('Turno Matutino', '08:00', '16:00', '{1,2,3,4,5}', true),
  ('Turno Vespertino', '14:00', '22:00', '{1,2,3,4,5}', true),
  ('Turno S√°bado', '09:00', '14:00', '{6}', true);</div>


<h4>5.2 Funciones Helper para SLA</h4>
</p><div class="code-block">-- Funci√≥n para calcular si una hora est√° en horario h√°bil
CREATE OR REPLACE FUNCTION es_horario_habil(
  timestamp_check TIMESTAMPTZ,
  horario_id UUID
) RETURNS BOOLEAN AS $
DECLARE
  horario RECORD;
  dia_semana INTEGER;
BEGIN
  SELECT * INTO horario FROM horarios WHERE id = horario_id;
  dia_semana := EXTRACT(DOW FROM timestamp_check);

  RETURN (
    dia_semana = ANY(horario.dias_semana) AND
    timestamp_check::TIME >= horario.hora_inicio AND
    timestamp_check::TIME <= horario.hora_fin
  );
END;
$ LANGUAGE plpgsql;</div>


<li>‚ö™ Implementar funci√≥n de c√°lculo de horarios h√°biles</li>
<li>‚ö™ Crear tabla de d√≠as festivos</li>

<h4>5.3 Frontend - Horarios</h4>

<li>‚ö™ Crear interfaz de configuraci√≥n de turnos</li>
<li>‚ö™ Mostrar turno actual del usuario</li>
<li>‚ö™ Asignar turnos a usuarios</li>

<h3>6. Auditor√≠a de Usuarios</h3>

<h4>6.1 Sistema de Auditor√≠a</h4>
</p><div class="code-block">CREATE TABLE public.audit_log (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  tabla TEXT NOT NULL,
  accion TEXT NOT NULL, -- INSERT, UPDATE, DELETE
  registro_id UUID,
  usuario_id UUID REFERENCES profiles(id),
  datos_anteriores JSONB,
  datos_nuevos JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Funci√≥n gen√©rica de auditor√≠a
CREATE OR REPLACE FUNCTION audit_trigger_function()
RETURNS TRIGGER AS $
BEGIN
  IF (TG_OP = 'DELETE') THEN
    INSERT INTO audit_log (tabla, accion, registro_id, usuario_id, datos_anteriores)
    VALUES (TG_TABLE_NAME, 'DELETE', OLD.id, auth.uid(), row_to_json(OLD));
    RETURN OLD;
  ELSIF (TG_OP = 'UPDATE') THEN
    INSERT INTO audit_log (tabla, accion, registro_id, usuario_id, datos_anteriores, datos_nuevos)
    VALUES (TG_TABLE_NAME, 'UPDATE', NEW.id, auth.uid(), row_to_json(OLD), row_to_json(NEW));
    RETURN NEW;
  ELSIF (TG_OP = 'INSERT') THEN
    INSERT INTO audit_log (tabla, accion, registro_id, usuario_id, datos_nuevos)
    VALUES (TG_TABLE_NAME, 'INSERT', NEW.id, auth.uid(), row_to_json(NEW));
    RETURN NEW;
  END IF;
END;
$ LANGUAGE plpgsql SECURITY DEFINER;

-- Aplicar trigger a tabla profiles
CREATE TRIGGER profiles_audit_trigger
  AFTER INSERT OR UPDATE OR DELETE ON profiles
  FOR EACH ROW EXECUTE FUNCTION audit_trigger_function();</div>


<h4>6.2 Historial de Sesiones</h4>
</p><div class="code-block">CREATE TABLE public.sesiones_log (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  usuario_id UUID REFERENCES profiles(id),
  accion TEXT, -- 'login', 'logout', 'login_failed'
  ip_address INET,
  user_agent TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);</div>


<li>‚ö™ Registrar logins exitosos</li>
<li>‚ö™ Registrar intentos fallidos</li>
<li>‚ö™ Implementar consulta de historial</li>

<h3>7. Panel de Administraci√≥n - Usuarios</h3>

<h4>7.1 Panel Admin</h4>

<li>‚ö™ Crear secci√≥n "Administraci√≥n" en men√∫</li>
<li>‚ö™ Crear submenu: Usuarios, Roles, Equipos, Horarios</li>
<li>‚ö™ Implementar dashboard de usuarios:</li>
  - ‚ö™ Total de usuarios activos/inactivos
  - ‚ö™ Usuarios por rol
  - ‚ö™ Usuarios por equipo
  - ‚ö™ Gr√°fica con ApexCharts
<li>‚ö™ Implementar filtros avanzados</li>
<li>‚ö™ Crear exportaci√≥n a CSV/Excel</li>
<li>‚ö™ Crear vista de actividad de usuarios</li>
<li>‚ö™ Mostrar historial de auditor√≠a</li>

<h3>8. Mejoras de UX</h3>

<h4>8.1 Componentes Visuales</h4>

<li>‚ö™ Crear badges de rol con colores:</li>
  - Admin: amarillo iGAS (#F9B000)
  - Coordinador: azul
  - T√©cnico: verde
  - Dev: morado
<li>‚ö™ Crear badges de estatus:</li>
  - Activo: verde (#4CAF50)
  - Inactivo: gris
<li>‚ö™ Crear indicador de disponibilidad:</li>
  - En l√≠nea: verde
  - Ocupado: amarillo
  - Fuera de turno: gris

---

<div class="content-section"><h2>Entregables</h2>

<li>‚ö™ Sistema de autenticaci√≥n completo y mejorado</li>
<li>‚ö™ CRUD de usuarios funcional con RLS</li>
<li>‚ö™ Sistema de roles y permisos operativo</li>
<li>‚ö™ Gesti√≥n de equipos implementada</li>
<li>‚ö™ Gesti√≥n de horarios/turnos</li>
<li>‚ö™ Sistema de auditor√≠a funcionando</li>
<li>‚ö™ Panel de administraci√≥n de usuarios</li>
<li>‚ö™ Guards y directivas de permisos</li>
<li>‚ö™ Documentaci√≥n de pol√≠ticas RLS</li>

<div class="content-section"><h2>Dependencias</h2>

<li>Fase 0: Configuraci√≥n inicial (COMPLETADA)</li>

<div class="content-section"><h2>Criterios de Aceptaci√≥n</h2>

<li>‚ö™ Usuarios pueden hacer login con credenciales asignadas</li>
<li>‚ö™ Admins pueden crear y gestionar usuarios completos</li>
<li>‚ö™ Sistema valida permisos en frontend y backend (RLS)</li>
<li>‚ö™ Usuarios pueden ser asignados a roles y equipos</li>
<li>‚ö™ Auditor√≠a registra todas las acciones</li>
<li>‚ö™ Panel admin permite gesti√≥n completa de usuarios</li>
<li>‚ö™ Guards protegen rutas seg√∫n permisos</li>
<li>‚ö™ No existe opci√≥n de registro p√∫blico (solo admins crean usuarios)</li>

<div class="content-section"><h2>Notas T√©cnicas Supabase</h2>

<li>Usar **Row Level Security (RLS)** para seguridad real a nivel de base de datos</li>
<li>**Triggers** de Supabase para auditor√≠a autom√°tica</li>
<li>**auth.uid()** para obtener usuario actual en policies</li>
<li>**Storage** de Supabase para avatares</li>
<li>Considerar **Supabase Edge Functions** para l√≥gica compleja</li>
<li>Usar **Realtime** para actualizaci√≥n de disponibilidad en tiempo real</li>
</p></div>

<!-- Historial de Versiones -->
<div class="content-section" id="historial-versiones" style="margin-top: 60px;">
<h2>Historial de Versiones - Fase 1</h2>

<div class="info-box" style="background: #f8f9fa; border-left: 4px solid #F9B000; padding: 20px; margin: 20px 0;">
    <p id="version-1-8-0"><strong>v1.8.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Implementar refresh token autom√°tico <a href="#setup-1-1" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ Configuraci√≥n expl√≠cita de autoRefreshToken en cliente Supabase</li>
        <li>‚úÖ Configuraci√≥n de persistSession con localStorage</li>
        <li>‚úÖ Implementaci√≥n de PKCE flow para mejor seguridad</li>
        <li>‚úÖ Custom storage key (igas-auth-token) para mejor organizaci√≥n</li>
        <li>‚úÖ Logging detallado de eventos de autenticaci√≥n (SIGNED_IN, SIGNED_OUT, TOKEN_REFRESHED, etc.)</li>
        <li>‚úÖ M√©todo refreshSession() para refresh manual si es necesario</li>
        <li>‚úÖ M√©todo getSessionInfo() para debugging y monitoreo de tokens</li>
        <li>‚úÖ Informaci√≥n de expiraci√≥n de tokens (minutesUntilExpiry)</li>
        <li>‚úÖ Manejo autom√°tico de errores de refresh con fallback a signOut</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-7-0"><strong>v1.7.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Eliminar links y referencias a "registro" en p√°gina de login <a href="#setup-1-2" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ Comentado signup menu item en navigation.ts</li>
        <li>‚úÖ Register route ya estaba comentado en routing</li>
        <li>‚úÖ Sistema confirma que no hay registro p√∫blico - solo admins crean usuarios</li>
        <li>‚úÖ Build y deploy exitoso a GitHub Pages</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-6-0"><strong>v1.6.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Agregar confirmaci√≥n visual de acciones <a href="#setup-1-2" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ Toast de √©xito en login: "¬°Bienvenido! Has iniciado sesi√≥n correctamente."</li>
        <li>‚úÖ Toast de √©xito en reset password: "Tu contrase√±a ha sido actualizada correctamente."</li>
        <li>‚úÖ Toast de info en logout: "Has cerrado sesi√≥n correctamente."</li>
        <li>‚úÖ Toast de error en logout fallido con mensaje descriptivo</li>
        <li>‚úÖ Integraci√≥n con NotificationService existente</li>
        <li>‚úÖ UX mejorada con feedback visual consistente</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-5-0"><strong>v1.5.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Implementar auto-logout por inactividad (30 min) <a href="#setup-1-2" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ InactivityService creado con timeout de 30 minutos</li>
        <li>‚úÖ Dashboard excluido de auto-logout por requerimiento del usuario</li>
        <li>‚úÖ Sistema detecta actividad: mouse, teclado, touch, scroll</li>
        <li>‚úÖ Monitoreo autom√°tico basado en rutas (route-aware)</li>
        <li>‚úÖ Mensaje de sesi√≥n expirada en login page</li>
        <li>‚úÖ Optimizaci√≥n con NgZone para performance</li>
        <li>‚úÖ Integraci√≥n en AppComponent con subscriber de usuario</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-4-0"><strong>v1.4.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Agregar "Remember me" en login <a href="#setup-1-2" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ Checkbox "Recordar datos" implementado en login</li>
        <li>‚úÖ Email guardado en localStorage cuando activado</li>
        <li>‚úÖ Auto-carga de email en login si existe</li>
        <li>‚úÖ Limpieza de localStorage si se desmarca</li>
        <li>‚úÖ Manejo seguro de errores en localStorage</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-3-0"><strong>v1.3.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Agregar loading states con spinner <a href="#setup-1-2" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ Spinner en bot√≥n de login durante autenticaci√≥n</li>
        <li>‚úÖ Texto "Iniciando sesi√≥n..." mientras carga</li>
        <li>‚úÖ Deshabilitaci√≥n de bot√≥n durante proceso</li>
        <li>‚úÖ Estados de loading en forgot-password y reset-password</li>
        <li>‚úÖ Feedback visual consistente en todas las p√°ginas auth</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-2-0"><strong>v1.2.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Personalizar p√°ginas con branding iGAS <a href="#setup-1-2" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ C√≠rculos de fondo con colores corporativos (amarillo #F9B000 y gris #3E3E3E)</li>
        <li>‚úÖ Checkbox con color primario iGAS amarillo</li>
        <li>‚úÖ Logo con fondo blanco y padding en sidebar</li>
        <li>‚úÖ HashLocationStrategy para GitHub Pages (fix 404 en reload)</li>
        <li>‚úÖ URLs ahora usan formato /#/ruta</li>
        <li>‚úÖ Limpieza de archivos temporales tmpclaude-*</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-1-0"><strong>v1.1.0</strong> - 12 de enero de 2026</p>
    <ul>
        <li>‚úÖ Mejorar manejo de errores con mensajes en espa√±ol <a href="#setup-1-1" style="font-size: 11px; color: #4CAF50;">[‚Üë ver punto]</a></li>
        <li>‚úÖ Helper error-messages.ts con mensajes amigables</li>
        <li>‚úÖ Mapper de errores de Supabase a espa√±ol</li>
        <li>‚úÖ Mensajes espec√≠ficos para cada tipo de error auth</li>
        <li>‚úÖ Validaciones con feedback claro en formularios</li>
        <li>‚úÖ Errores HTTP interceptados y formateados</li>
    </ul>

    <p style="margin-top: 15px;" id="version-1-0-0"><strong>v1.0.0</strong> - 11 de enero de 2026</p>
    <ul>
        <li>üéâ <strong>FASE 0 COMPLETADA - Inicio de Fase 1</strong></li>
        <li>‚úÖ Sistema de autenticaci√≥n base funcional (login, recovery, reset)</li>
        <li>‚úÖ Supabase Auth integrado con guards</li>
        <li>‚úÖ P√°ginas de autenticaci√≥n con template Datta-Able</li>
        <li>‚úÖ Branding iGAS aplicado (logo, colores corporativos)</li>
        <li>‚úÖ Routing configurado con lazy loading</li>
        <li>‚úÖ Sistema de notificaciones (toasts) implementado</li>
        <li>‚úÖ Base de datos con RLS policies configuradas</li>
    </ul>
</div>
</div>

    </div>

    <div class="footer">
        <p><strong>iGAS Control Volum√©trico</strong></p>
        <p>www.igas.mx | rroque.mor@igas.mx | 443 227 2217</p>
        <p style="margin-top: 15px; font-size: 12px;">
            √öltima actualizaci√≥n: 12 de enero de 2026<br>
            Fase 1: v1.8.0 - 8 tareas completadas
        </p>
    </div>
</body>
</html>